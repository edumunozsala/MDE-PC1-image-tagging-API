version: '1'
name: "image-tags-api"

services:

  mysql:
    ##### CHANGE IMAGE NAME TO MYSQL:8.0
    image: "mysql"
    container_name: mysql-itag
    environment:
      # password should be stored on an .env file, and use env_file option
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: ${MYSQL_USER_DATABASE}
      MYSQL_USER: ${MYSQL_USERNAME}
      MYSQL_PASSWORD: ${MYSQL_USER_PASSWORD}
    # Set the restart policy
    restart: unless-stopped

    expose:
      - 3306

    ports:
      - "3306:3306"

    volumes:
      - "mysql-image-tags:/var/lib/mysql/"
      - ./scripts/:/docker-entrypoint-initdb.d

  api-server:
    #image: "api-image-tag"
    build: 
      context: .
    container_name: apiserver-itag
    environment:
      # password should be stored on an .env file, and use env_file option
      IMAGE_FOLDER: ${IMAGE_FOLDER}
      MYSQL_SERVER: mysql-itag
      MYSQL_USER_DATABASE: ${MYSQL_USER_DATABASE}
      MYSQL_USERNAME: ${MYSQL_USERNAME}
      MYSQL_USER_PASSWORD: ${MYSQL_USER_PASSWORD}
    # Set the restart policy
    restart: unless-stopped
    depends_on:
      - mysql

    expose:
      - 80

    ports:
      - "80:80"

    volumes:
      - ./images/:/usr/src/app/images/

volumes:
  mysql-image-tags:
